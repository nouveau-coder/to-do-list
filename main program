import mysql.connector as ms
import random
con = ms.connect(host='localhost', username='root', password='1234', database='todolist')
cur = con.cursor()

def signup():
    try:
        name = input('Enter your name: ')
        password = input('Enter your password: ')
        user_id = random.randint(1000, 9999)
        print(f'Your user ID is: {user_id}. Please remember it for future logins.')
        cur.execute('INSERT INTO users (userid, name, password) VALUES (%s, %s, %s)', (user_id, name, password))
        con.commit()
        print('Signup successful!')
        return True, user_id
    except ms.Error as e:
        print(f'An error occurred: {e}')
        con.rollback()

def login():
    user_id = input('Enter your user ID: ')
    password = input('Enter your password: ')
    cur.execute('SELECT * FROM users WHERE userid = %s AND password = %s', (user_id, password))
    result = cur.fetchone()
    if result:
        print(f'Welcome {result[1]}!')
        return True, user_id
    else:
        print('Invalid user ID or password. Please try again.')
        
def add_task(user_id):
    task = input('Enter the task you want to add: ')
    try:
        cur.execute('INSERT INTO tasks (userid, task) VALUES (%s, %s)', (user_id, task))
        con.commit()
        print('Task added successfully!')
    except ms.Error as e:
        print(f'An error occurred: {e}')
        con.rollback()

def view_tasks(user_id):
    cur.execute('SELECT task FROM tasks WHERE userid = %s', (user_id,))
    tasks = cur.fetchall()
    if tasks:
        print('Your tasks:')
        for task in tasks:
            print(f'- {task[0]}')
    else:
        print('You have no tasks.')

def delete_task(user_id):
    task = input('Enter the task you want to delete: ')
    try:
        cur.execute('DELETE FROM tasks WHERE userid = %s AND task = %s', (user_id, task))
        con.commit()
        if cur.rowcount > 0:
            print('Task deleted successfully!')
        else:
            print('Task not found.')
    except ms.Error as e:
        print(f'An error occurred: {e}')
        con.rollback()

def main_menu(user_id):
    while True:
        print("\nMain Menu:")
        print("1. Add Task")
        print("2. View Tasks")
        print("3. Delete Task")
        print("4. Log Out")
        choice = input('Please choose an option (1-4): ')
        if choice == '1':
            add_task(user_id)
        elif choice == '2':
            view_tasks(user_id)
        elif choice == '3':
            delete_task(user_id)
        elif choice == '4':
            print('Logging out...')
            break
        else:
            print('Invalid choice. Please try again.')

while True:
    print("Welcome to the TopProductiv To-Do List Application")
    print("""1. Sign Up
2. Log In
3. Exit""")
    choice = input('Please choose an option (1 or 2): ')
    if choice == '1':
        signup_status,user_id = signup()
        if signup_status:
            main_menu(user_id)
    elif choice == '2':
        login_status, user_id = login()
        if login_status:
            main_menu(user_id)
    elif choice == '3':
        print('Thank you for using the TopProductiv To-Do List Application. Goodbye!')
        break
    



